#!/bin/bash
export PATH="/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin:$PATH"
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

if [ "${1:-}" = "-h" ] || [ "${1:-}" = "--help" ]; then
  echo "pt - Portuguese (pt-PT) proofreader powered by Ollama (gemma3:4b)"
  echo ""
  echo "Usage: pt <text>"
  echo "       echo <text> | pt"
  echo ""
  echo "Fixes spelling, accents, and punctuation errors in Portuguese text."
  exit 0
fi

if [ $# -gt 0 ]; then
  TEXT="$*"
elif [ ! -t 0 ]; then
  TEXT=$(cat)
else
  echo "Usage: pt <text> or echo <text> | pt (use -h for help)" >&2
  exit 1
fi

[ -z "$TEXT" ] && exit 0

SYSTEM='You are a Portuguese (pt-PT) proofreader. Fix ONLY spelling, accents, and punctuation errors. Do NOT add or remove words. Do NOT rephrase or rewrite. Do NOT translate. Keep informal/colloquial words as they are. Output ONLY the corrected text, nothing else.'

PAYLOAD=$(jq -n --arg sys "$SYSTEM" --arg text "$TEXT" '{
  "model": "gemma3:4b",
  "messages": [
    {"role": "system", "content": $sys},
    {"role": "user", "content": $text}
  ],
  "stream": false
}')

curl -s http://localhost:11434/api/chat -d "$PAYLOAD" | jq -r '.message.content'
