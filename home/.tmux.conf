# General
set-option -g prefix C-s
unbind C-b
set-option -g update-environment "EDITOR"
set-option -g mode-keys vi
set-option -g base-index 1
set-option -g pane-base-index 1
set-option -g mouse on
set-option -g history-limit 100000
set-option -g set-titles on
set-option -g set-titles-string "#{pane_title}"
set-option -g status-style bg=default
set-option -s focus-events on
set-option -s extended-keys on
set-option -s escape-time 0

# True color
set-option -g default-terminal "tmux-256color"
set-option -ag terminal-overrides ",*:RGB"

# Amp CLI compatibility
set-option -g allow-passthrough all
set-option -ga terminal-features ",*:hyperlinks"
set-option -s set-clipboard on

# Catppuccin Mocha theme
set-option -g window-style 'fg=#a6adc8,bg=#313244'
set-option -g window-active-style 'fg=terminal,bg=terminal'
set-option -g pane-border-style 'fg=#45475a'
set-option -g pane-active-border-style 'fg=#89b4fa'

# Session and config
bind R source-file ~/.tmux.conf
bind r move-window -r
bind < command-prompt -p "New session name:" "new-session -s '%%'"

# Windows and panes
bind -n 'M-t' new-window -c "#{pane_current_path}"
bind -n 'M-d' resize-pane -Z
bind -n 'M-e' run-shell "~/.local/bin/tmux-edit-scrollback"
bind -n 'M-N' split-window -c "#{pane_current_path}"
bind -n 'M-n' split-window -h -c "#{pane_current_path}"

# Window selection
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Pane navigation (seamless helix/tmux)
bind -n 'M-h' run-shell "~/.local/bin/tmux-helix-nav left"
bind -n 'M-j' run-shell "~/.local/bin/tmux-helix-nav down"
bind -n 'M-k' run-shell "~/.local/bin/tmux-helix-nav up"
bind -n 'M-l' run-shell "~/.local/bin/tmux-helix-nav right"

# URL picker
bind-key u capture-pane -J -S -500 \;\
  save-buffer /tmp/tmux-url-buffer \;\
  delete-buffer \;\
  split-window -l 10 "grep -oE 'https?://[^ >\"]+' /tmp/tmux-url-buffer | sort -u | fzf --no-preview --reverse | xargs open"

# Plugins
set-option -g @plugin 'tmux-plugins/tpm'
run '~/.tmux/plugins/tpm/tpm'
